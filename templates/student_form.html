<h4>ข้อมูลทั่วไป</h4>

<div class="col-12 mb-3">
    <label for="register_date" class="form-label">วันที่สมัคร</label>
    <input type="text" class="form-control" id="register_date" name="register_date" placeholder="วัน/เดือน/ปี" {% if
        student %} value="{{student.register_date}}" {% endif %}>
</div>


<div class="col-12 mb-3">
    <label for="student_id" class="form-label">รหัสนักเรียน</label>
    <input type="number" class="form-control" id="student_id" name="student_id" {% if student %}
        value="{{ student.student_id}}" disabled {% endif %}>
</div>

<div class="row mb-3">
    <div class="col mb-3">
        <label for="title" class="form-label">คำนำหน้า</label>
        <select class="form-select" id="title" name="title">
            <option value="ด.ญ." {% if student and student.title=="ด.ญ." %}selected{% endif %}>ด.ญ.</option>
            <option value="ด.ช." {% if student and student.title=="ด.ช." %}selected{% endif %}>ด.ช.</option>
            <option value="นาย" {% if student and student.title=="นาย" %}selected{% endif %}>นาย</option>
            <option value="นาง" {% if student and student.title=="นาง" %}selected{% endif %}>นาง</option>
            <option value="นางสาว" {% if student and student.title=="นางสาว" %}selected{% endif %}>นางสาว</option>
        </select>
    </div>

    <!-- Thai Name -->

    <div class="col mb-3">
        <label for="f_name" class="form-label">ชื่อ</label>
        <input type="text" class="form-control" id="f_name" name="f_name" {% if student %} value="{{student.f_name}}" {%
            endif %}>
    </div>

    <div class="col mb-3">
        <label for="l_name" class="form-label">นามสกุล</label>
        <input type="text" class="form-control" id="l_name" name="l_name" {% if student %} value="{{student.l_name}}" {%
            endif %}>
    </div>

    <!-- Eng Name -->
    <div class="col mb-3">
        <label for="f_eng_name" class="form-label">ชื่ออังกฤษ</label>
        <input type="text" class="form-control" id="f_eng_name" name="f_eng_name" {% if student %}
            value="{{student.f_eng_name}}" {% endif %}>
    </div>

    <div class="col mb-3">
        <label for="l_eng_name" class="form-label">นามสกุลอังกฤษ</label>
        <input type="text" class="form-control" id="l_eng_name" name="l_eng_name" {% if student %}
            value="{{student.l_eng_name}}" {% endif %}>
    </div>

    <div class="col mb-3">
        <label for="n_name" class="form-label">ชื่อเล่น</label>
        <input type="text" class="form-control" id="n_name" name="n_name" {% if student %} value="{{student.n_name}}" {%
            endif %}>
    </div>

</div>

<div class="col-12 mb-3">
    <label for="address" class="form-label">ที่อยู่</label>
    <textarea class="form-control" id="address" name="address" rows="2" {% if student %} value="{{student.address}}" {%
        endif %}></textarea>
</div>

<div class="row mb-3">
    <div class="col-6 mb-3">
        <label for="dob" class="form-label">วันเกิด</label>
        <input type="text" class="form-control" id="dob" name="dob" placeholder="วัน/เดือน/ปี" {% if student %}
            value="{{student.dob}}" {% endif %}>
    </div>

    <div class="col-6 mb-3">
        <label for="age" class="form-label">อายุ</label>
        <div id="age" class="input-group mb-3">

            <input type="number" class="form-control" id="age_years" readonly>
            <span class="input-group-text">ปี</span>

            <input type="number" class="form-control" id="age_months" readonly>
            <span class="input-group-text">เดือน</span>
        </div>

    </div>
</div>

<div class="col-12 mb-3">
    <label for="job" class="form-label">อาชีพ</label>
    <input type="text" class="form-control" id="job" name="job" {% if student %} value="{{student.job}}" {% endif %}>
</div>

<div class="row mb-3">
    <div class="col mb-3">
        <label for="email" class="form-label">อีเมล</label>
        <input type="email" class="form-control" id="email" name="email" {% if student %} value="{{student.email}}" {%
            endif %}>
    </div>

    <div class="col mb-3">
        <label for="phone_num" class="form-label">เบอร์โทร</label>
        <input type="tel" class="form-control" id="phone_num" name="phone_num" {% if student %}
            value="{{student.phone_num}}" {% endif %}>
    </div>
</div>

<h4>ข้อมูลครอบครัว</h4>

<div class="row mb-3">
    <div class="col mb-3">
        <label for="family_title" class="form-label">คำนำหน้า</label>
        <select class="form-select" name="family_title" {% if student %} value="{{student.family_title}}" {% endif %}>
            <option selected>นาย</option>
            <option value="1">นาง</option>
            <option value="2">นางสาว</option>
        </select>
    </div>

    <div class="col mb-3">
        <label for="family_f_name" class="form-label">ชื่อ</label>
        <input type="text" class="form-control" id="family_f_name" name="family_f_name" {% if student %}
            value="{{student.family_f_name}}" {% endif %}>
    </div>

    <div class="col mb-3">
        <label for="family_l_name" class="form-label">นามสกุล</label>
        <input type="text" class="form-control" id="family_l_name" name="family_l_name" {% if student %}
            value="{{student.family_l_name}}" {% endif %}>
    </div>

    <div class="col mb-3">
        <label for="family_relationship" class="form-label">ความสัมพันธ์</label>
        <input type="text" class="form-control" id="family_relationship" name="family_relationship" {% if student %}
            value="{{student.family_relationship}}" {% endif %}>
    </div>
</div>

<h4>ข้อมูลเพิ่มเติม</h4>

<div class="col-12 mb-3">
    <label for="instruments" class="form-label">เครื่องดนตรีที่มี</label>
    <input type="text" class="form-control" id="instruments" name="instruments" {% if student %}
        value="{{student.instruments}}" {% endif %}>
</div>


<script>
    $(document).ready(function () {

        var dobValue = $('#dob').val();
        if (dobValue) {
            setAge(dobValue)
        }
        
        thaiDatepicker("#dob, #register_date");
        function thaiDatepicker(el) {
            $.datetimepicker.setLocale('th')
            $(el).datetimepicker({
                timepicker: false,
                format: 'd/m/Y',
                lang: 'th',
                yearOffset: 543,
                validateOnBlur: false,
            })
        }

        // Function to calculate age in years and months
        function calculateAge(dob) {
            const birthDate = new Date(dob);
            const today = new Date();

            let years = today.getFullYear() - birthDate.getFullYear();
            let months = today.getMonth() - birthDate.getMonth();

            // Adjust for month difference
            if (months < 0) {
                years--;
                months += 12; // Adjust months to be positive
            }

            // Adjust for day of the month if today is earlier in the month than the birth date
            if (today.getDate() < birthDate.getDate()) {
                if (months === 0) {
                    years--; // If we're at the start of a year, reduce the year
                    months = 11; // Set months to 11
                } else {
                    months--; // Just reduce the months by one
                }
            }

            return { years, months }; // Return an object with both years and months
        }

        function setAge(dobValue) {
            if (/^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$/.test(dobValue)) {
                const parts = dobValue.split('/');
                const thaiYear = parseInt(parts[2], 10); // Get the Thai year
                const gregorianYear = thaiYear - 543; // Convert to Gregorian year
                const formattedDate = `${gregorianYear}-${parts[1]}-${parts[0]}`; // Convert to yyyy-mm-dd

                const age = calculateAge(formattedDate);
                $('#age_years').val(age.years); // Set the years in the input
                $('#age_months').val(age.months); // Set the months in the input
            } else {
                $('#age_years').val(''); // Clear years if date format is invalid
                $('#age_months').val(''); // Clear months if date format is invalid
            }
        }

        // Event listener for date of birth input change
        $('#dob').on('change', function () {
            setAge($(this).val());
        });
    });
</script>